<html>
    <head>

        <link rel="stylesheet" type="text/css" href="./css/playerControls.css">

        <title>Octopod Audio Player</title>


        <script src="./js/playerControls.js"></script>
        <script>

        "use strict"


        function audioContextCheck() {
            if (typeof AudioContext !== "undefined") {
                return new AudioContext();
            } else if (typeof webkitAudioContext !== "undefined") {
                return new webkitAudioContext();
            } else if (typeof mozAudioContext !== "undefined") {
                return new mozAudioContext();
            } else {
                throw new Error('AudioContext not supported');
            }
        }

        var audioContext = audioContextCheck();

        function Bufferator(buffer) {
            Buffer = buffer;
        }

        var sBuffer;
        var aBuffer;
        var tBuffer;
        var bBuffer;
        var sGain;
        var aGain;
        var tGain;
        var bGain;
        var Soprano;
        var Alto;
        var Tenor;
        var Bass;
        var playSoundMix;

        function loadSong(songName) {
        	Soprano = new XMLHttpRequest();
        	Soprano.open("get", "MP3/" + songName + "/Soprano.mp3", true);
        	Soprano.responseType = "arraybuffer";

        	Alto = new XMLHttpRequest();
        	Alto.open("get", "MP3/" + songName + "/Alto.mp3", true);
        	Alto.responseType = "arraybuffer";

        	Tenor = new XMLHttpRequest();
        	Tenor.open("get", "MP3/" + songName + "/Tenor.mp3", true);
        	Tenor.responseType = "arraybuffer";

        	Bass = new XMLHttpRequest();
        	Bass.open("get", "MP3/" + songName + "/Bass.mp3", true);
        	Bass.responseType = "arraybuffer";

        	Soprano.send();
        	Alto.send();
        	Tenor.send();
        	Bass.send();

        	Soprano.onload = function() {
        	    audioContext.decodeAudioData(Soprano.response, function(buffer){sBuffer=buffer});
        	};
        	Alto.onload = function() {
        	    audioContext.decodeAudioData(Alto.response, function(buffer){aBuffer=buffer});
        	};
        	Tenor.onload = function() {
        	    audioContext.decodeAudioData(Tenor.response, function(buffer){tBuffer=buffer});
        	};
        	Bass.onload = function() {
        	    audioContext.decodeAudioData(Bass.response, function(buffer){bBuffer=buffer});
        	};
        }

        function playback() {
            var playS = audioContext.createBufferSource();
            playS.buffer = sBuffer;
            var playA = audioContext.createBufferSource();
            playA.buffer = aBuffer;
            var playT = audioContext.createBufferSource();
            playT.buffer = tBuffer;
            var playB = audioContext.createBufferSource();
            playB.buffer = aBuffer;

            playSoundMix = audioContext.createGain();
            playSoundMix.gain.value = 0.5;
            sGain = audioContext.createGain();
            sGain.gain.value = 1;
            aGain = audioContext.createGain();
            aGain.gain.value = 1;
            tGain = audioContext.createGain();
            tGain.gain.value = 1;
            bGain = audioContext.createGain();
            bGain.gain.value = 1;

            playS.connect(sGain);
            sGain.connect(playSoundMix);
            playA.connect(aGain);
            aGain.connect(playSoundMix);
            playT.connect(tGain);
            tGain.connect(playSoundMix);
            playB.connect(bGain);
            bGain.connect(playSoundMix);
            playSoundMix.connect(audioContext.destination);

            var startTime = audioContext.currentTime + .2;

            playS.start(startTime);
            playA.start(startTime);
            playT.start(startTime);
            playB.start(startTime);

        }

        function changeVol(track, volLevel) {
            var level = volLevel/100;
            track.gain.value = level;
        }

        </script>
    </head>
    <body>
        Songs:<br>
    	<select onchange="loadSong(this.value)">
    	  <option>"--Select a song--"</option>
    	  <option value="ComeThouLongExpectedJesus">"Come Thou Long Expected Jesus"</option>
          <option value="JoyToTheWorld">"Joy To The World"</option>
          <option value="LoHowARose">"Lo How A Rose"</option>
          <option value="OComeOComeEmmanuel">"O Come O Come Emmanuel"</option>
          <option value="OHolyNight">"O Holy Night"</option>
    	  <option value="OLittleTownOfBethlehem">"O Little Town of Bethlehem"</option>
    	  <option value="OnceInRoyalDavidsCity">"Once in Royal David's City"</option>
    	  <option value="SilentNight">"Silent Night"</option>
    	</select>
    	<br>
    	<button onclick="playback()">play</button>
        <div class="slidecontainer">
          S: <input type="range" min="0" max="100" value="100" id="myRange" onchange="changeVol(sGain, this.value)">
        </div>
        <div class="slidecontainer">
          A: <input type="range" min="0" max="100" value="100" id="myRange" onchange="changeVol(aGain, this.value)">
        </div>
        <div class="slidecontainer">
          T: <input type="range" min="0" max="100" value="100" id="myRange" onchange="changeVol(tGain, this.value)">
        </div>
        <div class="slidecontainer">
          B: <input type="range" min="0" max="100" value="100" id="myRange" onchange="changeVol(bGain, this.value)">
        </div>
        <div class="slidecontainer">
          M: <input type="range" min="0" max="100" value="50" id="myRange" onchange="changeVol(playSoundMix, this.value)">
        </div>
    </body>
</html>
